#Integrate with social network to notify of changes and advance on the websites
name: Social networks notifications

on:
    workflow_call:
        inputs:
            # Required input to receive the status from the calling workflow (e.g., success() or failure())
            status:
                description: "The final status of the calling job/workflow (success or failure)."
                required: true
                type: string
            # Required input for the latest commit message
            commit_message:
                description: "The commit message related to the current build."
                required: true
                type: string
            # Required input for the full URL to the calling workflow run
            run_url:
                description: "The URL to the completed workflow run for logs."
                required: true
                type: string
            # Contextual information for better messages
            repo_name:
                description: "The repository name."
                required: true
                type: string
            branch:
                description: "The branch name."
                required: true
                type: string
        secrets:
            DISCORD_WEBHOOK:
                required: true
            TELEGRAM_TOKEN:
                required: true
            TELEGRAM_TO:
                required: true

jobs:
    live_notifications:
        runs-on: ubuntu-latest
        steps:
            - name: Notify on Success (Discord)
              if: ${{ inputs.status == 'success' }}
              uses: Ilshidur/action-discord@master
              env:
                  DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
              with:
                  args: |
                      ðŸ“¢ **New Deployment Alert**

                      **Repository:** `${{ inputs.repo_name }}`
                      **Branch:** `${{ inputs.branch }}`
                      **Status:** âœ… **SUCCESS** (New features/fixes live!)

                      **Commit Message:**
                      > *${{ inputs.commit_message }}*

                      [View Workflow Logs](${{ inputs.run_url }})
            - name: Notify on Failure (Discord)
              if: ${{ inputs.status == 'failure' }}
              uses: Ilshidur/action-discord@master
              env:
                  DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
              with:
                  args: |
                      ðŸš¨ **CRITICAL FAILURE ALERT**

                      **Repository:** `${{ inputs.repo_name }}`
                      **Branch:** `${{ inputs.branch }}`
                      **Status:** âŒ **FAILURE** (Deployment Halted!)

                      **Commit Message:**
                      > *${{ inputs.commit_message }}*

                      [Check Logs Immediately](${{ inputs.run_url }})
            - name: Telegram notify on Success
              if: ${{ inputs.status == 'success' }}
              uses: appleboy/telegram-action@master
              with:
                  to: ${{ secrets.TELEGRAM_TO }}
                  token: ${{ secrets.TELEGRAM_TOKEN }}
                  message: |
                      ðŸš€ **Successful Deployment**

                      **Repo:** ${{ inputs.repo_name }} (${{ inputs.branch }})
                      **Commit:** ${{ inputs.commit_message }}
                      [View Logs](${{ inputs.run_url }})
            - name: Telegram Notify on Failure
              # Check the status passed from the calling workflow
              if: ${{ inputs.status == 'failure' }}
              uses: appleboy/telegram-action@master
              with:
                  to: ${{ secrets.TELEGRAM_TO }}
                  token: ${{ secrets.TELEGRAM_TOKEN }}
                  message: |
                      ðŸ”´ **Deployment Failed**

                      **Repo:** ${{ inputs.repo_name }} (${{ inputs.branch }})
                      **Commit:** ${{ inputs.commit_message }}
                      [View Logs](${{ inputs.run_url }})
